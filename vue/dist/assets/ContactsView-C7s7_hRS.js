import{d as N,a as i,c,b as e,f as m,e as L,g as T,v as D,w as I,D as E,t as b,i as C,E as W,G as Y,o as a,_ as V,H as j,x as R,y as J,F as B,z as U,B as Q,A as X,n as Z}from"./index-CrttWU6e.js";import{T as A}from"./toast-Bla2j1_g.js";import{A as S}from"./Avatar_look-U-P1R498.js";const ee={class:"search-user-component"},se={class:"modal-body"},te={class:"search-form"},ne=["disabled"],ae={key:0,class:"search-result"},oe={class:"user-info"},le={class:"user-details"},ce={key:0,class:"user-status"},ie={class:"action-buttons"},re=["disabled"],ue={key:1,class:"no-result"},de=N({__name:"SearchUser",setup(q){const r=i(!1),u=i(""),o=i(null),k=i(!1),v=i(!1),h=i(!1),y=i(""),w=i("error"),g=()=>{r.value=!0},_=()=>{r.value=!1,o.value=null,k.value=!1},f=(d,s="error")=>{y.value=d,w.value=s},x=()=>{y.value=""},F=async()=>{if(x(),!u.value.trim()){f("请输入用户ID");return}const d=parseInt(u.value.trim());if(isNaN(d)||u.value.trim().length!==10){f("用户ID必须是10位数字");return}v.value=!0;try{const s=await W({id:d});o.value=s.data,k.value=!0,f("搜索成功","success")}catch(s){o.value=null,k.value=!0;let p="搜索用户失败";s.status===400?p="无效的用户ID格式":s.status===404?p="未找到该用户":s.message&&(p=s.message),f(p)}finally{v.value=!1}},M=async()=>{if(o.value){h.value=!0;try{await Y(o.value.id),f("好友请求已发送","success"),setTimeout(()=>{_()},2e3)}catch(d){let s="发送好友请求失败";d.status===400?s="好友请求已存在或对方已是您的好友":d.message&&(s=d.message),f(s)}finally{h.value=!1}}};return(d,s)=>(a(),c("div",ee,[e("div",{class:"search-input-wrapper",onClick:g},[T(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=p=>u.value=p),placeholder:"输入用户ID搜索用户",class:"search-input",readonly:""},null,512),[[D,u.value]]),e("button",{class:"search-button",onClick:I(g,["stop"])},s[3]||(s[3]=[e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)]))]),r.value?(a(),c("div",{key:0,class:"modal-overlay",onClick:_},[e("div",{class:"modal-content",onClick:s[2]||(s[2]=I(()=>{},["stop"]))},[e("div",{class:"modal-header"},[s[4]||(s[4]=e("h3",null,"搜索用户",-1)),e("button",{class:"close-button",onClick:_},"×")]),e("div",se,[e("div",te,[T(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=p=>u.value=p),placeholder:"请输入10位用户ID",class:"form-input",onKeypress:E(F,["enter"])},null,544),[[D,u.value]]),e("button",{class:"submit-button",onClick:F,disabled:v.value},b(v.value?"搜索中...":"搜索"),9,ne)]),o.value?(a(),c("div",ae,[e("div",oe,[C(S,{user:o.value,size:"large"},null,8,["user"]),e("div",le,[e("h4",null,b(o.value.username),1),o.value.user_status?(a(),c("p",ce)):m("",!0)])]),e("div",ie,[e("button",{class:"send-request-button",onClick:M,disabled:h.value},b(h.value?"发送中...":"发送好友请求"),9,re)])])):k.value&&!o.value?(a(),c("div",ue," 未找到该用户 ")):m("",!0)])])])):m("",!0),y.value?(a(),L(A,{key:1,message:y.value,type:w.value,onClose:x},null,8,["message","type"])):m("",!0)]))}}),ve=V(de,[["__scopeId","data-v-76eafb76"]]),pe="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1759127726646'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1353'%20width='16'%20height='16'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cpath%20d='M112%20184.365C112%20164.281%20128.282%20148%20148.366%20148h727.315c20.084%200%2036.366%2016.281%2036.366%2036.365%200%2020.083-16.282%2036.364-36.366%2036.364H148.366c-20.084%200-36.366-16.281-36.366-36.364zM112%20838.948c0-20.084%2016.282-36.365%2036.366-36.365h727.315c20.084%200%2036.366%2016.281%2036.366%2036.365%200%2020.084-16.282%2036.365-36.366%2036.365H148.366c-20.084%200-36.366-16.281-36.366-36.365zM112%20511.656c0-20.084%2016.282-36.365%2036.366-36.365h436.389c20.084%200%2036.365%2016.281%2036.365%2036.365%200%2020.083-16.281%2036.364-36.365%2036.364H148.366c-20.084%200-36.366-16.281-36.366-36.364z'%20fill='%23000000'%20p-id='1354'%3e%3c/path%3e%3cpath%20d='M753.499%20379.533L878.522%20483.72c17.447%2014.538%2017.447%2041.335%200%2055.873L753.499%20643.78c-23.686%2019.738-59.647%202.895-59.647-27.937V407.47c0-30.832%2035.961-47.675%2059.647-27.937z'%20fill='%233B72FF'%20p-id='1355'%3e%3c/path%3e%3c/svg%3e",me={class:"friends-list"},_e={key:0,class:"friend-requests-section"},he={class:"friend-info"},fe={class:"friend-details"},ke={class:"friend-name"},ye={class:"request-actions"},ge=["onClick"],be=["onClick"],we={key:1,class:"friends-section"},Ce={class:"friend-info"},xe={class:"friend-details"},Fe={class:"friend-name"},$e=["onClick"],Me=["src"],Re={key:0,class:"friend-actions-menu"},Te=["onClick"],De=["onClick"],Ie={key:2,class:"empty-state"},Se={class:"modal-actions"},Ne=N({__name:"FriendsList",setup(q){const r=j(),u=i(new Map),o=i(!1),k=i(0),v=i(""),h=i(!1),y=i(""),w=i("success"),g=R(()=>r.friends||[]),_=R(()=>r.pendingFriendRequests||[]),f=R(()=>r.error),x=r.acceptFriendRequest,F=r.rejectFriendRequest,M=r.removeFriend,d=r.setFriendNickname,s=(l,t="success")=>{y.value=l,w.value=t,h.value=!0},p=()=>{h.value=!1},G=l=>{u.value.set(l,!u.value.get(l))};J(f,l=>{l&&s(l,"error")});const H=(l,t)=>{k.value=l,v.value="",o.value=!0},z=async()=>{if(v.value.trim())try{await d(k.value,v.value.trim()),o.value=!1,s("备注设置成功","success")}catch{s("备注设置失败","error")}},K=async l=>{if(confirm("确定要删除这个好友吗？"))try{await M(l),s("好友删除成功","success")}catch{s("好友删除失败","error")}},O=async l=>{try{await x(l),s("已接受好友请求","success")}catch{s("接受好友请求失败","error")}},P=async l=>{try{await F(l),s("已拒绝好友请求","success")}catch{s("拒绝好友请求失败","error")}};return(l,t)=>(a(),c("div",me,[_.value?.length>0?(a(),c("div",_e,[e("h3",null,"好友请求 ("+b(_.value?.length)+")",1),(a(!0),c(B,null,U(_.value,n=>(a(),c("div",{key:n.id,class:"friend-request-item"},[e("div",he,[C(S,{user:n.sender_info,size:"medium"},null,8,["user"]),e("div",fe,[e("div",ke,b(n.sender_info?.username),1)])]),e("div",ye,[e("button",{onClick:$=>O(n.id),class:"accept-btn"},"接受",8,ge),e("button",{onClick:$=>P(n.id),class:"reject-btn"},"拒绝",8,be)])]))),128))])):m("",!0),g.value.length>0?(a(),c("div",we,[t[4]||(t[4]=e("h3",null,"我的好友",-1)),(a(!0),c(B,null,U(g.value,n=>(a(),c("div",{key:n.id,class:"friend-item"},[e("div",Ce,[C(S,{user:n.friend_info,size:"medium"},null,8,["user"]),e("div",xe,[e("div",Fe,b(n.nickname||n.friend_info?.username||"用户"),1)])]),e("button",{class:X(["expand-btn",{expanded:u.value.get(n.id)}]),onClick:$=>G(n.id)},[e("img",{src:Q(pe),alt:"展开"},null,8,Me)],10,$e),u.value.get(n.id)?(a(),c("div",Re,[e("button",{class:"action-btn note-btn",onClick:$=>H(n.id)}," 设置备注 ",8,Te),e("button",{class:"action-btn delete-btn",onClick:$=>K(n.id)}," 删除好友 ",8,De)])):m("",!0)]))),128))])):m("",!0),g.value.length===0&&(!_.value||_.value.length===0)?(a(),c("div",Ie,t[5]||(t[5]=[e("p",null,"暂无好友",-1),e("p",{class:"empty-hint"},"通过搜索添加好友开始聊天吧！",-1)]))):m("",!0),o.value?(a(),c("div",{key:3,class:"modal-overlay",onClick:t[3]||(t[3]=n=>o.value=!1)},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=I(()=>{},["stop"]))},[t[6]||(t[6]=e("h3",null,"设置好友备注",-1)),T(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>v.value=n),type:"text",placeholder:"请输入备注名称",class:"nickname-input",onKeyup:E(z,["enter"])},null,544),[[D,v.value]]),e("div",Se,[e("button",{onClick:t[1]||(t[1]=n=>o.value=!1),class:"cancel-btn"},"取消"),e("button",{onClick:z,class:"confirm-btn"},"确定")])])])):m("",!0),h.value?(a(),L(A,{key:4,message:y.value,type:w.value,onClose:p},null,8,["message","type"])):m("",!0)]))}}),Ve=V(Ne,[["__scopeId","data-v-92964ef8"]]),qe={class:"contacts-view"},ze=N({__name:"ContactsView",setup(q){const r=j();return Z(()=>{r.resetUnreadFriendMessages()}),(u,o)=>(a(),c("div",qe,[C(ve),C(Ve)]))}}),Ee=V(ze,[["__scopeId","data-v-5b49e2fc"]]);export{Ee as default};
