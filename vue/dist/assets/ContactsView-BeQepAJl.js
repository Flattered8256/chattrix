import{d as V,a as i,c,b as e,f as m,e as E,g as S,v as D,w as I,D as j,t as g,i as F,E as J,G as Q,o as l,_ as q,H as A,x as R,y as X,F as U,z as L,B as Z,A as ee,n as se}from"./index-CKue6E3g.js";import{T as G}from"./toast-214RgR-L.js";import{A as N}from"./Avatar_look-BhtLV2qL.js";const te={class:"search-user-component"},ne={class:"modal-body"},ae={class:"search-form"},oe=["disabled"],le={key:0,class:"search-result"},ce={class:"user-info"},ie={class:"user-details"},re={key:0,class:"user-status"},ue={class:"action-buttons"},de=["disabled"],ve={key:1,class:"no-result"},pe=V({__name:"SearchUser",setup(B){const r=i(!1),d=i(""),o=i(null),k=i(!1),v=i(!1),h=i(!1),y=i(""),w=i("error"),b=()=>{r.value=!0},_=()=>{r.value=!1,o.value=null,k.value=!1},f=(u,s="error")=>{y.value=u,w.value=s},x=()=>{y.value=""},$=async()=>{if(x(),!d.value.trim()){f("请输入用户ID");return}const u=parseInt(d.value.trim());if(isNaN(u)||d.value.trim().length!==10){f("用户ID必须是10位数字");return}v.value=!0;try{const s=await J({id:u});o.value=s.data,k.value=!0,f("搜索成功","success")}catch(s){o.value=null,k.value=!0;let p="搜索用户失败";s.status===400?p="无效的用户ID格式":s.status===404?p="未找到该用户":s.message&&(p=s.message),f(p)}finally{v.value=!1}},M=async()=>{if(o.value){h.value=!0;try{await Q(o.value.id),f("好友请求已发送","success"),setTimeout(()=>{_()},2e3)}catch(u){let s="发送好友请求失败";u.status===400?s="好友请求已存在或对方已是您的好友":u.message&&(s=u.message),f(s)}finally{h.value=!1}}},T=u=>({online:"在线",offline:"离线",away:"离开"})[u]||u;return(u,s)=>(l(),c("div",te,[e("div",{class:"search-input-wrapper",onClick:b},[S(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=p=>d.value=p),placeholder:"输入用户ID搜索用户",class:"search-input",readonly:""},null,512),[[D,d.value]]),e("button",{class:"search-button",onClick:I(b,["stop"])},s[3]||(s[3]=[e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)]))]),r.value?(l(),c("div",{key:0,class:"modal-overlay",onClick:_},[e("div",{class:"modal-content",onClick:s[2]||(s[2]=I(()=>{},["stop"]))},[e("div",{class:"modal-header"},[s[4]||(s[4]=e("h3",null,"搜索用户",-1)),e("button",{class:"close-button",onClick:_},"×")]),e("div",ne,[e("div",ae,[S(e("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=p=>d.value=p),placeholder:"请输入10位用户ID",class:"form-input",onKeypress:j($,["enter"])},null,544),[[D,d.value]]),e("button",{class:"submit-button",onClick:$,disabled:v.value},g(v.value?"搜索中...":"搜索"),9,oe)]),o.value?(l(),c("div",le,[e("div",ce,[F(N,{user:o.value,size:"large"},null,8,["user"]),e("div",ie,[e("h4",null,g(o.value.username),1),o.value.user_status?(l(),c("p",re," 状态: "+g(T(o.value.user_status)),1)):m("",!0)])]),e("div",ue,[e("button",{class:"send-request-button",onClick:M,disabled:h.value},g(h.value?"发送中...":"发送好友请求"),9,de)])])):k.value&&!o.value?(l(),c("div",ve," 未找到该用户 ")):m("",!0)])])])):m("",!0),y.value?(l(),E(G,{key:1,message:y.value,type:w.value,onClose:x},null,8,["message","type"])):m("",!0)]))}}),me=q(pe,[["__scopeId","data-v-33617197"]]),_e="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1759127726646'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1353'%20width='16'%20height='16'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cpath%20d='M112%20184.365C112%20164.281%20128.282%20148%20148.366%20148h727.315c20.084%200%2036.366%2016.281%2036.366%2036.365%200%2020.083-16.282%2036.364-36.366%2036.364H148.366c-20.084%200-36.366-16.281-36.366-36.364zM112%20838.948c0-20.084%2016.282-36.365%2036.366-36.365h727.315c20.084%200%2036.366%2016.281%2036.366%2036.365%200%2020.084-16.282%2036.365-36.366%2036.365H148.366c-20.084%200-36.366-16.281-36.366-36.365zM112%20511.656c0-20.084%2016.282-36.365%2036.366-36.365h436.389c20.084%200%2036.365%2016.281%2036.365%2036.365%200%2020.083-16.281%2036.364-36.365%2036.364H148.366c-20.084%200-36.366-16.281-36.366-36.364z'%20fill='%23000000'%20p-id='1354'%3e%3c/path%3e%3cpath%20d='M753.499%20379.533L878.522%20483.72c17.447%2014.538%2017.447%2041.335%200%2055.873L753.499%20643.78c-23.686%2019.738-59.647%202.895-59.647-27.937V407.47c0-30.832%2035.961-47.675%2059.647-27.937z'%20fill='%233B72FF'%20p-id='1355'%3e%3c/path%3e%3c/svg%3e",he={class:"friends-list"},fe={key:0,class:"friend-requests-section"},ke={class:"friend-info"},ye={class:"friend-details"},ge={class:"friend-name"},be={class:"request-actions"},we=["onClick"],Ce=["onClick"],Fe={key:1,class:"friends-section"},xe={class:"friend-info"},$e={class:"friend-details"},Me={class:"friend-name"},Te=["onClick"],Re=["src"],Se={key:0,class:"friend-actions-menu"},De=["onClick"],Ie=["onClick"],Ne=["onClick"],Ve={key:2,class:"empty-state"},qe={class:"modal-actions"},Be=V({__name:"FriendsList",setup(B){const r=A(),d=i(new Map),o=i(!1),k=i(0),v=i(""),h=i(!1),y=i(""),w=i("success"),b=R(()=>r.friends||[]),_=R(()=>r.pendingFriendRequests||[]),f=R(()=>r.error),x=r.acceptFriendRequest,$=r.rejectFriendRequest,M=r.removeFriend,T=r.blockFriend,u=r.setFriendNickname,s=(a,t="success")=>{y.value=a,w.value=t,h.value=!0},p=()=>{h.value=!1},H=a=>{d.value.set(a,!d.value.get(a))};X(f,a=>{a&&s(a,"error")});const K=(a,t)=>{k.value=a,v.value="",o.value=!0},z=async()=>{if(v.value.trim())try{await u(k.value,v.value.trim()),o.value=!1,s("备注设置成功","success")}catch{s("备注设置失败","error")}},O=async a=>{if(confirm("确定要删除这个好友吗？"))try{await M(a),s("好友删除成功","success")}catch{s("好友删除失败","error")}},P=async a=>{if(confirm("确定要屏蔽这个好友吗？"))try{await T(a),s("好友已屏蔽","success")}catch{s("屏蔽好友失败","error")}},W=async a=>{try{await x(a),s("已接受好友请求","success")}catch{s("接受好友请求失败","error")}},Y=async a=>{try{await $(a),s("已拒绝好友请求","success")}catch{s("拒绝好友请求失败","error")}};return(a,t)=>(l(),c("div",he,[_.value?.length>0?(l(),c("div",fe,[e("h3",null,"好友请求 ("+g(_.value?.length)+")",1),(l(!0),c(U,null,L(_.value,n=>(l(),c("div",{key:n.id,class:"friend-request-item"},[e("div",ke,[F(N,{user:n.sender_info,size:"medium"},null,8,["user"]),e("div",ye,[e("div",ge,g(n.sender_info?.username),1)])]),e("div",be,[e("button",{onClick:C=>W(n.id),class:"accept-btn"},"接受",8,we),e("button",{onClick:C=>Y(n.id),class:"reject-btn"},"拒绝",8,Ce)])]))),128))])):m("",!0),b.value.length>0?(l(),c("div",Fe,[t[4]||(t[4]=e("h3",null,"我的好友",-1)),(l(!0),c(U,null,L(b.value,n=>(l(),c("div",{key:n.id,class:"friend-item"},[e("div",xe,[F(N,{user:n.friend_info,size:"medium"},null,8,["user"]),e("div",$e,[e("div",Me,g(n.nickname||n.friend_info?.username||"用户"),1)])]),e("button",{class:ee(["expand-btn",{expanded:d.value.get(n.id)}]),onClick:C=>H(n.id)},[e("img",{src:Z(_e),alt:"展开"},null,8,Re)],10,Te),d.value.get(n.id)?(l(),c("div",Se,[e("button",{class:"action-btn note-btn",onClick:C=>K(n.id)}," 设置备注 ",8,De),e("button",{class:"action-btn block-btn",onClick:C=>P(n.id)}," 屏蔽好友 ",8,Ie),e("button",{class:"action-btn delete-btn",onClick:C=>O(n.id)}," 删除好友 ",8,Ne)])):m("",!0)]))),128))])):m("",!0),b.value.length===0&&(!_.value||_.value.length===0)?(l(),c("div",Ve,t[5]||(t[5]=[e("p",null,"暂无好友",-1),e("p",{class:"empty-hint"},"通过搜索添加好友开始聊天吧！",-1)]))):m("",!0),o.value?(l(),c("div",{key:3,class:"modal-overlay",onClick:t[3]||(t[3]=n=>o.value=!1)},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=I(()=>{},["stop"]))},[t[6]||(t[6]=e("h3",null,"设置好友备注",-1)),S(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>v.value=n),type:"text",placeholder:"请输入备注名称",class:"nickname-input",onKeyup:j(z,["enter"])},null,544),[[D,v.value]]),e("div",qe,[e("button",{onClick:t[1]||(t[1]=n=>o.value=!1),class:"cancel-btn"},"取消"),e("button",{onClick:z,class:"confirm-btn"},"确定")])])])):m("",!0),h.value?(l(),E(G,{key:4,message:y.value,type:w.value,onClose:p},null,8,["message","type"])):m("",!0)]))}}),ze=q(Be,[["__scopeId","data-v-f9e6fce0"]]),Ue={class:"contacts-view"},Le=V({__name:"ContactsView",setup(B){const r=A();return se(()=>{r.resetUnreadFriendMessages()}),(d,o)=>(l(),c("div",Ue,[F(me),F(ze)]))}}),Ge=q(Le,[["__scopeId","data-v-5b49e2fc"]]);export{Ge as default};
